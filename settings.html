<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>הגדרות מערכת</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
    }
    .tab-content {
      margin-top: 20px;
    }
    .form-check {
      margin-bottom: 10px;
    }
    .save-btn-container {
      text-align: center;
      margin-top: 30px;
    }
  </style>
<link href="assets/css/styles.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="assets/js/scripts.js" defer></script>
</head>

<body>
  <div class="container mt-5">
    <h2 class="text-center mb-4">הגדרות מערכת</h2>

    <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">כללי</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="invoices-tab" data-bs-toggle="tab" data-bs-target="#invoices" type="button" role="tab">חשבוניות</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab">שידור הזמנות</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="integrations-tab" data-bs-toggle="tab" data-bs-target="#integrations" type="button" role="tab">אינטגרציות</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="emails-tab" data-bs-toggle="tab" data-bs-target="#emails" type="button" role="tab">מיילים והתראות</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="backup-tab" data-bs-toggle="tab" data-bs-target="#backup" type="button" role="tab">גיבוי ותחזוקה</button>
      </li>
    </ul>

    <form class="tab-content" id="settingsTabsContent">
      <!-- כל הטפסים כאן נשמרים בטופס אחד -->
      <div class="tab-pane fade show active" id="general" role="tabpanel">
        <div class="mt-3">
          <div class="mb-3">
            <label class="form-label">עלות משלוח ברירת מחדל (₪)</label>
            <input type="number" class="form-control" name="default_shipping" value="35">
          </div>
          <div class="mb-3">
            <label class="form-label">מטבע ברירת מחדל</label>
            <select class="form-select" name="default_currency">
              <option selected>₪</option>
              <option>$</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">תאריך התחלה לדוחות חודשיים</label>
            <input type="date" class="form-control" name="report_start_date">
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="invoices" role="tabpanel">
        <div class="mt-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="auto_invoice_api" checked>
            <label class="form-check-label">הפקת חשבונית אוטומטית ללקוחות API</label>
          </div>
          <div class="mb-3">
            <label class="form-label">לקוחות עם חשבונית מרוכזת</label>
            <textarea class="form-control" rows="2" name="group_invoice_clients">מועדון טוב, דולצה ויטה</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">תזמון הפקת חשבוניות</label>
            <select class="form-select" name="invoice_schedule">
              <option>אוטומטי מדי יום</option>
              <option>ידני</option>
              <option>סוף חודש</option>
            </select>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="orders" role="tabpanel">
        <div class="mt-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="auto_send_chita">
            <label class="form-check-label">שלח אוטומטית לצ'יטה</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="auto_label">
            <label class="form-check-label">הפקת מדבקה אוטומטית להזמנה</label>
          </div>
          <div class="mb-3">
            <label class="form-label">טמפלט מדבקה</label>
            <input type="file" class="form-control" name="label_template">
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="integrations" role="tabpanel">
        <div class="mt-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="enable_api" checked>
            <label class="form-check-label">API</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="enable_excel" checked>
            <label class="form-check-label">קובץ אקסל</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="enable_mirakl" checked>
            <label class="form-check-label">Mirakl</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="enable_manual">
            <label class="form-check-label">מחיר ידני</label>
          </div>
          <div class="mb-3 mt-3">
            <label class="form-label">אימייל ברירת מחדל להזמנות</label>
            <input type="email" class="form-control" name="default_order_email" placeholder="example@domain.com">
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="emails" role="tabpanel">
        <div class="mt-3">
          <div class="mb-3">
            <label class="form-label">כתובת מייל לשגיאות מערכת</label>
            <input type="email" class="form-control" name="error_email">
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="alert_excel_errors">
            <label class="form-check-label">שלח התראה אם אקסל כולל שגיאות</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="alert_unprocessed_orders">
            <label class="form-check-label">התראה להזמנות שלא טופלו</label>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="backup" role="tabpanel">
        <div class="mt-3">
          <button class="btn btn-secondary mb-2" type="button">הורד גיבוי נתונים</button><br>
          <button class="btn btn-outline-primary mb-2" type="button">ייצוא כל ההגדרות ל‑CSV</button><br>
          <button class="btn btn-danger" type="button">איפוס כל ההגדרות לברירת מחדל</button>
        </div>
      </div>

      <div class="save-btn-container">
        <button type="submit" class="btn btn-success btn-lg">שמור הגדרות</button>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.querySelector('form').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = {};

      formData.forEach((value, key) => {
        if (data[key]) {
          if (!Array.isArray(data[key])) data[key] = [data[key]];
          data[key].push(value);
        } else {
          data[key] = value === 'on' ? true : value;
        }
      });

      console.log('הגדרות שנשמרו:', data);
      alert('ההגדרות נשמרו (בדיקה מקומית בלבד)');
    });
  </script>
<script>
  window.addEventListener('load', function() {
    fetch('includes/toolbar.html')
      .then(response => response.text())
      .then(html => {
        document.body.insertAdjacentHTML('afterbegin', html);
      })
      .catch(error => console.error('Error loading toolbar:', error));
  });
</script>
</body>

</html>
