<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>הזמנות חדשות</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f5f5f5;
      padding: 30px;
    }
    h2 {
      margin-bottom: 30px;
    }
    .table th, .table td {
      vertical-align: middle;
    }
    .btn-group .btn, .bulk-actions .btn {
      margin-left: 5px;
    }
    .tag {
      display: inline-block;
      background-color: #d1e7dd;
      color: #0f5132;
      border-radius: 20px;
      padding: 5px 10px;
      margin: 2px;
    }
    .tag button {
      background: none;
      border: none;
      margin-right: 5px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="mb-3 text-end">
      <a href="index.html" class="btn btn-outline-dark">חזרה לדף הבית</a>
    </div>
    <h2 class="text-center">הזמנות חדשות</h2>

    <!-- סינון -->
    <div class="card p-3 mb-4">
      <div class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">חיפוש כללי</label>
          <input type="text" id="searchInput" class="form-control" placeholder="מס' הזמנה, שם לקוח, טלפון, עיר...">
        </div>
        <div class="col-md-3">
          <label class="form-label">פלטפורמה</label>
          <select id="platformFilter" class="form-select">
            <option value="">הכל</option>
            <option value="BOXMASTER">BOXMASTER</option>
            <option value="PRO-TOOLS">PRO-TOOLS</option>
            <option value="מועדון טוב">מועדון טוב</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">סטטוס</label>
          <select id="statusFilter" class="form-select">
            <option value="">הכל</option>
            <option value="הזמנה חדשה">הזמנה חדשה</option>
            <option value="בטיפול">בטיפול</option>
            <option value="הושלמה">הושלמה</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">שיטת שילוח</label>
          <select id="shippingFilter" class="form-select">
            <option value="">הכל</option>
            <option value="צ'יטה עם מדבקה">צ'יטה עם מדבקה</option>
            <option value="נקודת איסוף">נקודת איסוף</option>
            <option value="איסוף עצמי">איסוף עצמי</option>
            <option value="חריג">חריג</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-outline-secondary w-100" onclick="resetFilters()">איפוס</button>
        </div>
      </div>
    </div>

    <!-- פעולות מרובות -->
    <div class="bulk-actions mb-3">
      <button class="btn btn-success" onclick="handleBulkAction()">טפל בהזמנות נבחרות</button>
    </div>

    <!-- טבלת הזמנות -->
    <table class="table table-bordered text-center" id="ordersTable">
      <thead class="table-dark">
        <tr>
          <th><input type="checkbox" id="selectAll"></th>
          <th>תאריך</th>
          <th>מס' הזמנה</th>
          <th>שם לקוח</th>
          <th>טלפון</th>
          <th>עיר</th>
          <th>פלטפורמה</th>
          <th>כמות</th>
          <th>מוצר</th>
          <th>סטטוס</th>
          <th>שיטת שילוח</th>
          <th>פעולות</th>
        </tr>
      </thead>
      <tbody id="ordersBody">
        <!-- יתווסף דינמית -->
      </tbody>
    </table>
  </div>

  <script>
    const orders = JSON.parse(localStorage.getItem('importedOrders')) || [];

    function displayOrders(list) {
      const tbody = document.getElementById('ordersBody');
      tbody.innerHTML = '';

      list.forEach((order, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="checkbox" class="order-checkbox"></td>
          <td>${order.date || ''}</td>
          <td>${order.id || ''}</td>
          <td>${order.name || ''}</td>
          <td>${order.phone || ''}</td>
          <td>${order.city || ''}</td>
          <td>${order.platform || ''}</td>
          <td>${order.quantity || ''}</td>
          <td>${order.product || ''}</td>
          <td><span class="badge bg-warning status">${order.status || 'הזמנה חדשה'}</span></td>
          <td><span class="badge bg-primary">${order.shipping || 'רגיל'}</span></td>
          <td>
            <a href="order-details.html?orderId=${order.id}" class="btn btn-outline-info btn-sm">צפה</a>
            <a href="edit-order.html?orderId=${order.id}" class="btn btn-outline-secondary btn-sm">ערוך</a>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function applyFilters() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const platform = document.getElementById('platformFilter').value;
      const status = document.getElementById('statusFilter').value;
      const shipping = document.getElementById('shippingFilter').value;

      const filtered = orders.filter(order => {
        const searchText = `${order.id || ''} ${order.name || ''} ${order.phone || ''} ${order.city || ''}`.toLowerCase();
        return (!search || searchText.includes(search)) &&
               (!platform || order.platform === platform) &&
               (!status || order.status === status) &&
               (!shipping || order.shipping === shipping);
      });

      displayOrders(filtered);
    }

    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('platformFilter').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('shippingFilter').value = '';
      displayOrders(orders);
    }

    function handleBulkAction() {
      const checkboxes = document.querySelectorAll('.order-checkbox:checked');
      checkboxes.forEach(cb => {
        const row = cb.closest('tr');
        const statusSpan = row.querySelector('.status');
        statusSpan.textContent = 'בטיפול';
        statusSpan.classList.remove('bg-warning');
        statusSpan.classList.add('bg-success');
      });
    }

    document.getElementById('selectAll').addEventListener('change', function () {
      document.querySelectorAll('.order-checkbox').forEach(cb => cb.checked = this.checked);
    });

    document.getElementById('searchInput').addEventListener('input', applyFilters);
    document.getElementById('platformFilter').addEventListener('change', applyFilters);
    document.getElementById('statusFilter').addEventListener('change', applyFilters);
    document.getElementById('shippingFilter').addEventListener('change', applyFilters);

    displayOrders(orders);
  </script>
</body>
</html>
